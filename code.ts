figma.showUI(__html__, {
  width: 262,
  height: 362,
});

const darkbgURL = [
 "https://cdn.dribbble.com/userupload/7958962/file/original-e0a0cbba222edc08b69f88a22659ce53.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958964/file/original-8a66239f8882d9ce11accb8c5f5e3273.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958960/file/original-43cec7c5d52b1f3d92dfa9ac6808e842.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958954/file/original-944d24a14946192fd80767a1e7eb9322.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958961/file/original-e3fdaf707f03d25a943a8b062c0d237a.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958959/file/original-9734b53a753e69e2a46a3d72b12d790a.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958967/file/original-34fd12cafaf0319a0c8c42c6c3ce263c.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958966/file/original-42ecca7fa513029742384c3750eda932.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958963/file/original-6a693b9effdb991f1d9893abaf85e6b8.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958955/file/original-429441a044f92575304ccdc2210adc8f.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958958/file/original-8d40512425519e9d5e3453b11e97a7e2.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958956/file/original-d015ad7e5a7c4600e1be68abea45f05e.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958953/file/original-24912ff42f25e2b665c073ad07e7fa68.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958965/file/original-ddef22042f5d925df83c9a12530f4635.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958949/file/original-e7db1017f143899a08d141b5f72ac839.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958948/file/original-277b23f94d73ae864344c9caa24d0e23.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958952/file/original-7117f122f409c8846af3c9ff8c8edcbc.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958947/file/original-ba079662ad33c6df11943fdbc3cf4077.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958946/file/original-e8430014d37446bf5bb8fe9af029435e.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958957/file/original-348ab96cefa061d13206b0a2fccf15cc.png?compress=1&resize=752x",
 "https://cdn.dribbble.com/userupload/7958951/file/original-1dccd18d44c885d8ef8c6cfdaaf9f18c.png?compress=1&resize=752x",
"https://cdn.dribbble.com/userupload/7958950/file/original-6044e660c5bbb9ba8bc0c30516c41440.png?compress=1&resize=752x",
"https://cdn.dribbble.com/userupload/7958945/file/original-f95561afdebcc0a286432207918fc730.png?compress=1&resize=752x",
"https://cdn.dribbble.com/userupload/7958944/file/original-60c96ade548ffd7a3c09ab7b42b97c64.png?compress=1&resize=752x"

];
const lightbgURL = [
  
 
 
  "https://cdn.dribbble.com/userupload/7956979/file/original-f9287b2327c6942c6137d0c4fdba8a9b.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956977/file/original-af7f76931674fe39e2747cf3719ab6b4.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956972/file/original-212a95137ffb1b0a96d705b8cb99d9f6.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956973/file/original-0b99c173741083f6c2c6b84499a8d406.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956970/file/original-24b7bd559b745c9b74239d38d28b8f70.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956997/file/original-8c6fa5aa6de820ed967e5a753ddd1daf.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956984/file/original-91458ce6de509a872da5ba7367d9f4c1.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956989/file/original-06d928627ed6bd65e16267bef64df5b3.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957001/file/original-b4f289c7f577bba6a8fce3430cd36743.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956986/file/original-1b1b8be6312e408e36deec9bb24da09a.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956998/file/original-a427a4f7ddd64c435d708362cf4970b0.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956992/file/original-3d806c13a5090010879e0b8f28a5c676.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957000/file/original-d1e6c3d29a445afda399c5db626f8443.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956999/file/original-cb3603813afdf465cc6a7ac7cead0cfd.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956993/file/original-cc68db9b20ace9ba56cff81132583a9f.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956982/file/original-e04b0c1b79e750c2d3698768ca05a7fb.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957006/file/original-319830da8169392ea6c0c209a09e4f7f.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957004/file/original-4f1aa450bc4edfc40f5bba334bd5a599.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957011/file/original-f912ec121dae8a9b9fdc9dfe4305fa45.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957017/file/original-df87542f5b5487781d2aeb511d98014f.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957005/file/original-63f54d371f51447987a76205feec5457.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957019/file/original-9302c7061cfcaa6a3b8a24c7c1c6d67c.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957014/file/original-b5e644ef28278beab55a2f3f819f7902.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957003/file/original-ff259da22648ddb8a6c7e67e294a46ff.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957016/file/original-5c9f552f2f97d77187094d2724c49a06.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957010/file/original-1cb8d534bbcb1b30fd33cae51e45c2e6.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957009/file/original-29000207d3aad2d96b029de54d66b731.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957008/file/original-2bc29f06e997b1d06f0d14989a7710bb.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957018/file/original-664b61763c232ee2fae826ed117d7514.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957012/file/original-3a789b2687b50fa0b7bbbc095965db66.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957013/file/original-aeb8ffc5e3b74b94c4b6c5495a70dad2.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957015/file/original-06c4e048c74d212e79a416830eaca5f7.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957007/file/original-195b1be39e635c7d2f1856f37deb6bc1.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957020/file/original-797481b7bfc3ff79dfa50cb3e83bf9fc.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956994/file/original-d93604eb3d6ab9ef2666280dfa6075d1.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956996/file/original-2d8347e2d4ef2f418fa06481e0dbb35e.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956981/file/original-193e981750d5e88cd0ef4f3d61c572e7.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956990/file/original-f477ba8bcaaa5b3df90a9ba840702084.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956983/file/original-dad74bf7987e27a113fd0f5ce54e08f8.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956985/file/original-fb7aea75f903e0ffca0f7ea3ddb28d0d.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956987/file/original-63570a91e076ec2072cd0e884c31b3a4.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956995/file/original-4bbfe5ead119514ff9d4be55e78f582e.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956991/file/original-499a183b5effafc33c1c170a61650461.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7956988/file/original-f7567f855ecd6708fc6c730e98d260c8.png?compress=1&resize=752x",
  "https://cdn.dribbble.com/userupload/7957002/file/original-412faa0bc84ff60171e24b7f629a01d4.png?compress=1&resize=752x"

];

let lightIndex = 0;
let darkIndex = 0;

function getNextElementLight() {
  const lightElement = lightbgURL[lightIndex];
  lightIndex = (lightIndex + 1) % lightbgURL.length;
  console.log(lightElement);
  return lightElement;
}

function getNextElementDark() {
  const darkElement = darkbgURL[darkIndex];
  darkIndex = (darkIndex + 1) % darkbgURL.length;
  return darkElement;
}

let startingX = 0 
let startingY = 0 


figma.ui.onmessage = async (msg) => {
  console.log("the message is ", msg.type);
  if (msg.type === "createLinear") {
    const node: SceneNode[] = [];

    console.log("code ts: palette no: " + msg.palette);
    console.log("code ts: angle :" + msg.angle);

    //HUE GRADIENT GENRATOR
    //color lib : pastel colors
    const colorlib1 = [
      "#EAFFCC",
      "#CFEDFC",
      "#FFFECC",
      "#CDFEE2",
      "#FDFCCE",
      "#CFEBFC",
      "#CEF6FD",
      "#FAF6D1",
      "#FEF4CD",
      "#CEFDDC",
      "#D8D0FB",
      "#FCDBCF",
      "#D1D6FA",
      "#FAD2D1",
      "#CFD0FC",
      "#FBD0EE",
      "#EBCCFF",
      "#F2D1FA",
      "#FECDD7",
      "#F2D1FA",
      "#FECDFB",
      "#FCD8CF",
      "#FFDCCC",
      "#FCCFDC",
      "#FBE6D0",
      "#D0FBEF",
      "#D1FADC",
    ];
    // COOL GRADIENTS
    const colorlib2 = [
      "#9EFFEF",
      "#C2FFE4",
      "#F5FFA8",
      "#9EFFD8",
      "#ADCEFF",
      "#BAFFAD",
      "#ADCEFF",
      "#FFC7FB",
      "#C2FFCD",
      "#FFDCB8",
      "#C7FFD0",
      "#FFA3CE",
      "#99A8FF",
      "#E299FF",
      "#FFC7CA",
      "#FFE5B3",
      "#FFA8C2",
      "#FFA8B0",
      "#FFF599",
      "#FFD899",
      "#FFCCD6",
      "#99FDFF",
      "#D1B3FF",
      "#FFC7FB",
      "#A3CEFF",
      "#ADC0FF",
    ];
    //brigt colors
    const colorlib3 = [
      "#79F9FB",
      "#90FEAD",
      "#93FBC9",
      "#FAFD49",
      "#00F5A0",
      "#00D9F5",
      "#7DF943",
      "#3775FB",
      "#00C3FF",
      "#FFFF1C",
      "#FC6767",
      "#F7906E",
      "#FC3BB2",
      "#FF5E62",
      "#FF9966",
      "#FD495E",
      "#F9DB43",
      "#F2994A",
      "#F2C94C",
      "#DA48FE",
      "#52C7FA",
      "#BE4DFF",
      "#FB4BF0",
      "#F84978",
    ];
    const colorlib4 = [
      "#BBEF39",
      "#62EE17",
      "#0F0CC6",
      "#790EFB",
      "#3064F3",
      "#D81326",
      "#E74C3C",
      "#4B0082",
      "#9400D3",
      "#E100FF",
      "#FF3352",
      "#F4067D",
      "#E62B19",
      "#F10956",
      "#F63C9F",
      "#E71DE7",
      "#6335F8",
      "#0F4ED7",    
      "#4B0082",    
      "#7F00FF",    

      ];

    function rand() {
      return Math.floor(Math.random() * 11);
    }
    console.log("code.ts: random no chosen", rand());
    let hexCol1;
    let hexCol2;

    //creating a frame to contain all the rectanges
    const tintNode = figma.createFrame();
    tintNode.name = "Linear Gradient";
    tintNode.cornerRadius = 20;
    tintNode.resize(150, 150);
    tintNode.x = startingX ;
    tintNode.y = startingY 
   startingX= startingX+ 160; 
   if(startingX>=800)
   {startingX=0
  startingY=startingY+200}
    

    // rect for gradient fill
    const gradientrect = figma.createRectangle();
    gradientrect.name = "Gradient fill";
    gradientrect.cornerRadius = 20;
    gradientrect.resize(150, 150);

    switch (msg.palette) {
      case "1":
        hexCol1 = colorlib1[rand()];
        hexCol2 = colorlib1[rand()];
        if (hexCol1 == hexCol2) {
          hexCol1 = colorlib1[rand()];
          hexCol2 = colorlib1[rand()];
        }
        break;

      case "2":
        hexCol1 = colorlib2[rand()];
        hexCol2 = colorlib2[rand()];
        if (hexCol1 == hexCol2) {
          hexCol1 = colorlib1[rand()];
          hexCol2 = colorlib1[rand()];
        }
        break;

      case "3":
        hexCol1 = colorlib3[rand()];
        hexCol2 = colorlib3[rand()];
        if (hexCol1 == hexCol2) {
          hexCol1 = colorlib3[rand()];
          hexCol2 = colorlib3[rand()];
        }
        break;
      case "4":
        hexCol1 = colorlib4[rand()];
        hexCol2 = colorlib4[rand()];
        if (hexCol1 == hexCol2) {
          hexCol1 = colorlib4[rand()];
          hexCol2 = colorlib4[rand()];
        }
        break;
    }

    console.log("code.ts colorhex 1: ", hexCol1);
    console.log("code.ts colorhex 2: ", hexCol2);
    const hexToRBG = (hex: string | undefined) => {
      let result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
      return result
        ? {
            r: parseInt(result[1], 16),
            g: parseInt(result[2], 16),
            b: parseInt(result[3], 16),
          }
        : null;
    };
    const color1R = hexToRBG(hexCol1).r / 300;
    const color1G = hexToRBG(hexCol1).g / 255;
    const color1B = hexToRBG(hexCol1).b / 255;
    const color2R = hexToRBG(hexCol2).r / 255;
    const color2G = hexToRBG(hexCol2).g / 255;
    const color2B = hexToRBG(hexCol2).b / 255;
    console.log("value of color 1 r ,g, b", color1R, color1B, color1G);
    console.log("value of color 2 r ,g, b", color2R, color2B, color2G);

    const DEFAULT_AFFINE_TRANSFORMS = {
      "0": [
        [0, -1, 1],
        [1, 0, 0.5],
      ],
      "45": [
        [0.5, -0.5, 0.5],
        [0.5, 0.5, 0],
      ],
      "90": [
        [1, 0, 0],
        [0, 1, 0.5],
      ],
      "135": [
        [0.5, 0.5, 0],
        [-0.5, 0.5, 0.5],
      ],
      "180": [
        [0, 1, 0],
        [-1, 0, 1.5],
      ],
      "225": [
        [-0.5, 0.5, 0.5],
        [-0.5, -0.5, 1],
      ],
      "270": [
        [-1, 0, 1],
        [0, -1, 1.5],
      ],
      "315": [
        [-0.5, -0.5, 1],
        [0.5, -0.5, 0.5],
      ],
      "360": [
        [0, -1, 1],
        [1, 0, 0.5],
      ],
    };
    const angle = msg.angle;
    console.log(angle);
    // console.log()
    //hi
    gradientrect.fills = [
      {
        type: "GRADIENT_LINEAR",
        gradientTransform: DEFAULT_AFFINE_TRANSFORMS[angle],
        gradientStops: [
          { position: 0, color: { r: color1R, g: color1G, b: color1B, a: 1 } },
          { position: 1, color: { r: color2R, g: color2G, b: color2B, a: 1 } },
        ],
      },
    ];

    tintNode.appendChild(gradientrect);
    node.push(tintNode);

    // noise function

    const imageUrl =
      "https://cdn.dribbble.com/userupload/7416672/file/original-e5a33c53f346f07a3c3cefb06a3e911d.png?compress=1&resize=1024x1024";

    fetch(imageUrl)
      .then((response) => response.arrayBuffer())
      .then((buffer) => {
        const imageUint8Array = new Uint8Array(buffer);
        const imageHash = figma.createImage(imageUint8Array).hash;

        // Create a rectangle node
        const noise = figma.createRectangle();
        noise.name = "noise";
        noise.cornerRadius = 20;
        
        noise.fills = [
          {
            type: "IMAGE",
            scaleMode: "FIT",
            imageHash: imageHash,
            blendMode: "OVERLAY",
          },
        ];
        
        noise.resize(350, 350); // Set the width and height of the rectangle
        const Linnoisevalue = msg.LinOpacity;
        noise.opacity = Linnoisevalue;

        console.log("linear noise opacity", msg.LinOpacity);
        // Add the rectangle to the current page
        // figma.currentPage.appendChild(rectangle);

        tintNode.appendChild(noise);
        // Zoom to fit the newly created rectangle

        figma.notify("🎨 Gradient Added");
        figma.viewport.scrollAndZoomIntoView(node);
        figma.currentPage.selection = node;
        // setTimeout(() => {
        //   figma.closePlugin();
        // }, 100);
      })

      .catch((error) => {
        console.error("Error loading image:", error);
      });
  }
  //  MESH GRADIENT
  if (msg.type === "createMesh") {
    const node2: FrameNode[] = [];
    const meshNode = figma.createFrame();
    meshNode.resize(250, 250);
    meshNode.cornerRadius = 20;
    meshNode.name = "mesh gradient";
    meshNode.x = startingX ;
    meshNode.y = startingY 
   startingX= startingX+ 280; 
   if(startingX>=1000)
   {startingX=0
  startingY=startingY+300}
    function rand() {
      return Math.floor(Math.random() * 2);
    }


    // noise function

    const imageUrl =
      "https://cdn.dribbble.com/userupload/7416672/file/original-e5a33c53f346f07a3c3cefb06a3e911d.png?compress=1&resize=1024x1024";

    fetch(imageUrl)
      .then((response) => response.arrayBuffer())
      .then((buffer) => {
        const imageUint8Array = new Uint8Array(buffer);
        const imageHash = figma.createImage(imageUint8Array).hash;

        // Create a rectangle node
        const noise = figma.createRectangle();
        noise.name = "noise";
        noise.resize(250, 250); // Set the width and height of the rectangle
        noise.cornerRadius = 20;

        noise.fills = [
          {
            type: "IMAGE",
            scaleMode: "CROP",
            imageHash: imageHash,
            blendMode: "OVERLAY",
          },
        ];

        const noisevalue = msg.MeshOpacity;
        noise.opacity = noisevalue;

        console.log("mesh noise opacity", msg.MeshOpacity);
        meshNode.appendChild(noise);

      })

      .catch((error) => {
        console.error("Error loading image:", error);
      });

      var URL;
      console.log(msg.bgType);
      if (msg.bgType == "dark") {
        URL = getNextElementDark();
      } else {
        URL = getNextElementLight();
      }
  
      fetch(URL)
        .then((response) => response.arrayBuffer())
        .then((buffer) => {
          const imageUint8Array = new Uint8Array(buffer);
          const imageHash = figma.createImage(imageUint8Array).hash;
  
          // Create a rectangle node
          const meshgrad = figma.createRectangle();
          meshgrad.resize(250, 250); // Set the width and height of the rectangle
          meshgrad.name = "gradient image";
          
          meshgrad.fills = [
            {
              type: "IMAGE",
              scaleMode: "FILL",
              imageHash: imageHash,
            },
          ];
          meshNode.appendChild(meshgrad);
        })
        .catch((error) => {
          console.error("Error loading image:", error);
        });
        
    node2.push(meshNode);
    figma.notify("✅ Gradient Added");
    figma.viewport.scrollAndZoomIntoView(node2);
    figma.currentPage.selection = node2;
  }

  if (msg.type == "cancel") {
    figma.closePlugin();
  }
};
